# 개발일지 - PWA 설정

**작성 시각**: 2025-12-10

## 해결하고자 한 문제
- 사용자가 브라우저 없이 앱처럼 "당신이 잠든 사이"를 사용할 수 있도록 PWA 설치 지원
- 홈 화면에 아이콘 추가로 빠른 접근성 제공
- 오프라인 상태에서도 이전 브리핑 열람 가능
- 플랫폼별 맞춤 설치 안내 (Android, iOS, Desktop)

## 해결된 것
✅ **PWA 기본 설정**
- `next-pwa` 패키지 설치 및 설정
- `manifest.json` 생성 (이름, 설명, 아이콘, 테마 색상 등)
- Service Worker 자동 생성 및 등록
- NetworkFirst 캐싱 전략 구현

✅ **설치 프롬프트 UI**
- `PWAInstallPrompt` 컴포넌트 생성
- Android Chrome: 자동 설치 프롬프트 지원
- iOS Safari: 수동 설치 가이드 모달 (단계별 안내)
- Desktop: 주소창 설치 아이콘 안내
- 스마트 표시 로직 (3회 이상 표시 또는 거부 시 7일간 숨김)
- 로컬스토리지에 표시 이력 저장

✅ **업데이트 알림**
- `PWAUpdatePrompt` 컴포넌트 생성
- Service Worker 업데이트 감지
- 새 버전 설치 시 상단 배너 표시
- 원클릭 업데이트 기능

✅ **오프라인 지원**
- `/offline` 페이지 생성
- 네트워크 상태 감지
- 오프라인 안내 메시지 및 캐시된 브리핑 링크
- 자동 재연결 감지 및 리다이렉트

✅ **iOS 지원**
- Apple 메타 태그 추가 (`apple-mobile-web-app-capable`, `apple-mobile-web-app-status-bar-style` 등)
- `apple-touch-icon` 설정
- iOS 설치 가이드 모달 (공유 버튼 → 홈 화면에 추가)

✅ **아이콘 디자인 및 생성**
- SVG 아이콘 생성 (달과 별이 있는 밤하늘 테마)
- 아이콘 생성 스크립트 작성 (Node.js, Bash)
- 아이콘 생성 가이드 문서 작성
- **PNG 아이콘 파일 생성 완료** (2025-12-11)
  - `icon-192.png` (4.7 KB) - Android 기본 아이콘
  - `icon-512.png` (16 KB) - Android 고해상도 아이콘
  - `icon-180.png` (4.7 KB) - iOS 아이콘
  - `icon-maskable.png` (16 KB) - Android Adaptive Icon

✅ **프로덕션 빌드 및 타입 에러 수정** (2025-12-11)
- Next.js 16 Turbopack/Webpack 충돌 해결 (`--webpack` 플래그 추가)
- framer-motion 타입 에러 수정 (`ease` 배열에 `as const` 추가)
- Toast 컴포넌트 타입 수정 (`warning` → `info`)
- Top3ComparisonCard props 타입 추가 (`index` prop)
- next-pwa 타입 선언 파일 생성 (`types/next-pwa.d.ts`)
- Next.js 16 viewport export 추가 (`themeColor` 이동)
- **프로덕션 빌드 성공** ✅
- Service Worker 파일 생성 확인 (`sw.js`, `workbox-*.js`)

✅ **프로덕션 서버 테스트** (2025-12-11)
- 프로덕션 서버 실행 및 정상 작동 확인
- manifest.json 정상 로드 확인
- PWA 컴포넌트 통합 확인 (`PWAInstallPrompt`, `PWAUpdatePrompt`)
- README.md 작성 완료

✅ **성능 최적화**
- Service Worker 캐싱 전략 (NetworkFirst)
- 24시간 캐시 유효기간, 최대 200개 항목
- 자동 업데이트 및 백그라운드 다운로드

## 해결되지 않은 것 / 향후 개선 필요
✅ **아이콘 파일 생성** - 완료 (2025-12-11)
✅ **프로덕션 빌드** - 완료 (2025-12-11)

⚠️ **푸시 알림 (선택 사항)**
- 매일 아침 7시 브리핑 알림 기능 미구현
- 중요 속보 실시간 알림 미구현
- 브라우저 푸시 권한 요청 미구현
- iOS는 푸시 알림 미지원 (iOS 16.4+에서 일부 지원)

⚠️ **HTTPS 배포**
- PWA는 HTTPS에서만 작동 (localhost 제외)
- 프로덕션 배포 시 HTTPS 설정 필요
- 로컬 테스트를 위한 HTTPS 설정 가이드 필요

⚠️ **Lighthouse 테스트**
- PWA 점수 90+ 목표 달성 확인 필요
- 실제 배포 후 Lighthouse 테스트 필요

## 기술적 세부사항

### 사용한 기술/라이브러리
- **next-pwa**: Next.js용 PWA 플러그인
- **Workbox**: Service Worker 라이브러리 (next-pwa 내장)
- **Framer Motion**: 설치 프롬프트 애니메이션
- **Intersection Observer**: 네트워크 상태 감지

### 주요 파일 구조
```
public/
  ├── manifest.json          # PWA 메타데이터
  ├── icon.svg               # 아이콘 소스 파일
  ├── icon-192.png           # (생성 필요)
  ├── icon-512.png           # (생성 필요)
  ├── icon-maskable.png      # (생성 필요)
  └── icon-180.png           # (생성 필요)

components/
  ├── PWAInstallPrompt.tsx   # 설치 프롬프트 UI
  └── PWAUpdatePrompt.tsx    # 업데이트 알림 UI

app/
  └── offline/
      └── page.tsx           # 오프라인 페이지

scripts/
  ├── generate-icons.js      # Node.js 아이콘 생성 스크립트
  └── generate-icons.sh      # Bash 아이콘 생성 스크립트
```

### Service Worker 전략
- **NetworkFirst**: 최신 데이터 우선, 오프라인 시 캐시 사용
- **캐시 관리**: 24시간 유효, 최대 200개 항목
- **자동 업데이트**: 새 버전 자동 감지 및 활성화

### 설치 프롬프트 로직
1. 플랫폼 감지 (Android/iOS/Desktop)
2. 설치 상태 확인 (standalone 모드 체크)
3. 로컬스토리지에서 프롬프트 이력 확인
4. 조건에 맞으면 프롬프트 표시
5. 사용자 선택에 따라 이력 저장

## 향후 개발을 위한 컨텍스트

### 다음 개발자가 알아야 할 정보
1. **아이콘 생성**: ✅ 완료 (2025-12-11)
   - 모든 PNG 아이콘 파일이 `public/` 폴더에 생성되어 있습니다.
   - 아이콘을 변경하려면 `public/icon.svg`를 수정한 후 `npm run generate-icons` 실행
   - `sharp` 패키지가 필요합니다 (이미 devDependencies에 포함됨)

2. **HTTPS 필수**: PWA는 HTTPS에서만 작동합니다 (localhost 제외).
   - 프로덕션 배포 시 HTTPS 설정 필요
   - 로컬 테스트는 `npm run dev`로 가능하지만 Service Worker는 비활성화됨

3. **프로덕션 빌드**: ✅ 완료 (2025-12-11)
   - `npm run build --webpack` 실행 (Next.js 16에서 webpack 명시 필요)
   - `npm start`로 프로덕션 서버 실행 가능
   - Service Worker는 개발 모드에서 비활성화됨

4. **플랫폼별 차이점**:
   - Android Chrome: 자동 설치 프롬프트 지원
   - iOS Safari: 수동 설치만 가능 (공유 버튼 사용)
   - Desktop: 주소창 설치 아이콘 또는 배너

5. **Service Worker 파일**: `next-pwa`가 자동으로 생성하는 파일들
   - `public/sw.js`
   - `public/workbox-*.js`
   - `.gitignore`에 이미 추가되어 있음

6. **캐싱 전략**: 현재 NetworkFirst 전략 사용
   - 최신 데이터 우선
   - 네트워크 실패 시 캐시 사용
   - 필요시 CacheFirst로 변경 가능

7. **업데이트 감지**: Service Worker 업데이트 시 자동으로 배너 표시
   - 사용자가 업데이트 버튼 클릭 시 즉시 새로고침
   - 백그라운드 자동 업데이트도 가능 (설정 변경 필요)

### 확장 가능성
- 푸시 알림 기능 추가 (Web Push API)
- 백그라운드 동기화 (Background Sync API)
- 오프라인 폼 제출
- 앱 배지 (Badge API) - 읽지 않은 브리핑 개수 표시
- 공유 타겟 (Share Target API) - 다른 앱에서 공유하기

### 참고 자료
- [PWA 가이드](https://web.dev/progressive-web-apps/)
- [Manifest 검증기](https://manifest-validator.appspot.com/)
- [PWA Builder](https://www.pwabuilder.com/)
- [next-pwa 문서](https://github.com/shadowwalker/next-pwa)

