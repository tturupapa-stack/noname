# 개발일지 - 이메일 발송 기능 연동

**작성 시각**: 2025-12-27
**작업자**: Claude Code

## 해결하고자 한 문제

기존 Daily Briefing 워크플로우는 Slack 알림만 지원했습니다. 사용자가 이메일로도 화제 종목 브리핑을 받을 수 있도록 이메일 발송 기능을 추가해야 했습니다.

## 해결된 것

### 1. 이메일 발송 스크립트 (`backend/scripts/send_email.py`)
- Gmail SMTP를 사용한 마크다운 이메일 발송 유틸리티
- 마크다운 → HTML 자동 변환
- 테스트 완료

### 2. Daily Briefing에 이메일 단계 통합 (`backend/scripts/daily_briefing.py`)
- `run_email()` 메소드 추가 (Step 4)
- `_markdown_to_html()` 헬퍼 메소드 추가
- CLI에 `--step email` 옵션 추가
- `run_all()` 흐름에 이메일 단계 통합

### 3. GitHub Actions 워크플로우 업데이트 (`.github/workflows/daily-briefing.yml`)
- `email` step 옵션 추가
- 이메일 관련 환경변수 3개 추가:
  - `GMAIL_ADDRESS`
  - `GMAIL_APP_PASSWORD`
  - `EMAIL_RECIPIENTS`

## 해결되지 않은 것

없음

## 향후 개발을 위한 컨텍스트 정리

### 사용법

```bash
# 로컬 실행 (Slack 알림만)
python -m scripts.daily_briefing

# 이메일만 전송 (GitHub Actions 또는 테스트용)
python -m scripts.daily_briefing --step email

# 드라이런 (실제 전송 없이 테스트)
python -m scripts.daily_briefing --dry-run
```

**참고**: 이메일 발송은 GitHub Actions에서만 자동 실행됩니다. 로컬에서 `--step all` 실행 시 Slack 알림까지만 수행됩니다.

### 환경 변수

| 변수 | 설명 | 필수 |
|------|------|------|
| `GMAIL_ADDRESS` | 발신자 Gmail 주소 | 이메일 사용시 |
| `GMAIL_APP_PASSWORD` | Gmail 앱 비밀번호 | 이메일 사용시 |
| `EMAIL_RECIPIENTS` | 수신자 이메일 (쉼표 구분) | 이메일 사용시 |

### GitHub Secrets 설정 필요

GitHub 저장소 > Settings > Secrets and variables > Actions에서 위 3개 시크릿 추가 필요

### 실행 흐름

**로컬 실행 (`--step all`)**:
```
1. 화제 종목 조회 (screener)
2. 뉴스 수집 (news)
3. 브리핑 생성 (briefing)
4. Slack 알림 (notify)
```

**GitHub Actions 실행**:
```
1. 화제 종목 조회 (screener)
2. 뉴스 수집 (news)
3. 브리핑 생성 (briefing)
4. Slack 알림 (notify)
5. 이메일 전송 (email) ← GitHub Actions 전용
```

### 파일 구조

```
backend/scripts/
├── daily_briefing.py  # 이메일 단계 추가됨
└── send_email.py      # 범용 이메일 발송 유틸리티

.github/workflows/
└── daily-briefing.yml # 이메일 환경변수 추가됨
```

### 다음 개선 사항

- [ ] 이메일 템플릿 디자인 개선
- [ ] 첨부파일 지원 (차트 이미지 등)
- [ ] 발송 실패 시 재시도 로직
