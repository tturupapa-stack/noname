# 개발일지 - 화제 종목 스크리너

**작성 시각**: 2025-12-15

## 해결하고자 한 문제

복합 지표 기반의 "진짜 핫한 주식" 선정 시스템 구현
- 단순 거래량/변동률이 아닌 다차원 평가 필요
- 왜 핫한지(WHY HOT) 설명 자동 생성
- yahooquery 라이브러리 활용

## 해결된 것

✅ **3개 스크리너 통합 수집**
- most_actives, day_gainers, day_losers
- 각 타입에서 TOP 10 → 총 30개 후보

✅ **복합 점수 시스템 (40점 만점)**
- 거래량 급증 (10점): 평소 대비 3배↑ = 10점, 2배↑ = 7점, 1.5배↑ = 5점
- 가격 변동 (10점): 5%↑ = 10점, 3%↑ = 7점, 2%↑ = 5점
- 모멘텀 일관성 (10점): 5일&10일 수익률 양수 = 10점, 5일만 = 5점
- 시가총액 적정성 (10점): $2B~$100B = 10점, $1B~$200B = 5점

✅ **WHY HOT 자동 생성**
- 거래량 급증 여부
- 가격 변동 상태
- 모멘텀 추세
- PER 경고 (100배 초과 시)

✅ **API 엔드포인트**
- `GET /api/stock/hot` - 오늘의 화제 종목 조회

✅ **테스트 완료**
- 서비스 단위 테스트 통과
- API 테스트 통과
- 결과 예시: LULU 40/40점 (거래량 3.54배, +9.6%, 상승추세)

## 해결되지 않은 것

⚠️ 뉴스 조회 기능 - 일부 종목에서 news 데이터 미반환
⚠️ 캐싱 미적용 - 동일 요청 시 매번 API 호출

## 향후 개발을 위한 컨텍스트 정리

### 파일 구조
```
backend/
├── models/stock.py          # Pydantic 모델
├── services/screener_service.py  # HotStockScreener 클래스
├── api/stock.py             # FastAPI 라우터
└── main.py                  # 앱 엔트리포인트
```

### 핵심 클래스
```python
class HotStockScreener:
    def get_daily_hot_stock() -> HotStockResponse
    def _get_candidates() -> List[Dict]           # 30개 후보 수집
    def _calculate_scores() -> List[Dict]         # 복합 점수 계산
    def _calculate_momentum_score() -> int        # 모멘텀 점수 (history 사용)
    def _generate_why_hot() -> List[WhyHotItem]   # WHY HOT 생성
```

### API 응답 형식
```json
{
  "stock": {
    "symbol": "LULU",
    "name": "lululemon athletica inc.",
    "price": 204.97,
    "change_percent": 9.6,
    "volume": 14364698,
    "volume_ratio": 3.54,
    "market_cap": 24307220480,
    "pe_ratio": 14.24
  },
  "score": {
    "volume_score": 10,
    "price_change_score": 10,
    "momentum_score": 10,
    "market_cap_score": 10,
    "total": 40
  },
  "why_hot": [
    {"icon": "✅", "message": "거래량 급증 (평소 대비 3.54배)"},
    {"icon": "✅", "message": "당일 9.6% 상승"}
  ]
}
```

### 서버 실행
```bash
cd backend
uvicorn main:app --reload --port 8000
```

### 다음 개선 사항
1. 뉴스 조회 안정화 (에러 처리 강화)
2. 응답 캐싱 (Redis 또는 메모리 캐시)
3. 후보 종목 수 조절 가능하게 파라미터화
