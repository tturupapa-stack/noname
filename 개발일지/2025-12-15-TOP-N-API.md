# 개발일지 - TOP N 종목 API

**작성 시각**: 2025-12-15

## 해결하고자 한 문제

TOP N 종목 조회 API 구현
- 스크리너 타입별 상위 N개 종목 조회
- 각 종목에 순위 포함
- count 파라미터로 조회 개수 지정 (1~10)

## 해결된 것

✅ **Pydantic 모델 추가** (`models/stock.py`)
- `RankedStock`: 순위가 포함된 종목 (rank, stock, score)
- `TopNStocksResponse`: TOP N 응답 (screener_type, count, stocks[])

✅ **스크리너 서비스 확장** (`services/screener_service.py`)
- `get_top_n_stocks(screener_type, count)` 메서드 추가
- count 범위 검증 (1~10)
- 점수순 정렬 (동점시 거래량순)

✅ **API 엔드포인트 추가** (`api/stock.py`)
```
GET /api/stocks/trending/top?type={type}&count={count}
```

✅ **테스트 완료**
```
GET /api/stocks/trending/top?type=most_actives&count=5
→ AKRO(30점), K(25점), ONDS(20점), TSLA(17점), NVDA(0점)

GET /api/stocks/trending/top?type=day_gainers&count=3
→ IMNM(37점), ORLA(22점), ZIM(20점)
```

## 해결되지 않은 것

⚠️ 뉴스 미포함 - 개별 종목 뉴스는 `/api/stocks/{ticker}` 사용

## 향후 개발을 위한 컨텍스트 정리

### API 사용법

```bash
# most_actives TOP 5
curl "http://localhost:8000/api/stocks/trending/top?type=most_actives&count=5"

# day_gainers TOP 3
curl "http://localhost:8000/api/stocks/trending/top?type=day_gainers&count=3"

# day_losers TOP 10
curl "http://localhost:8000/api/stocks/trending/top?type=day_losers&count=10"
```

### 응답 형식

```json
{
  "screener_type": "most_actives",
  "count": 5,
  "stocks": [
    {
      "rank": 1,
      "stock": {
        "symbol": "AKRO",
        "name": "Akero Therapeutics, Inc.",
        "price": 54.65,
        "change_percent": 0.0,
        "volume": 11609142,
        "volume_ratio": 4.41,
        "market_cap": 4499031040
      },
      "score": {
        "volume_score": 10,
        "price_change_score": 0,
        "momentum_score": 10,
        "market_cap_score": 10,
        "total": 30
      }
    }
  ]
}
```

### 전체 API 목록

| 엔드포인트 | 설명 |
|-----------|------|
| GET /api/stocks/trending | 화제 종목 TOP 1 (뉴스 포함) |
| GET /api/stocks/trending/top | TOP N 종목 리스트 |
| GET /api/stocks/{ticker} | 종목 상세 정보 (뉴스 포함) |

### 다음 개선 사항

1. TOP N에도 뉴스 포함 옵션 추가
2. 응답 캐싱
3. 프론트엔드 연동 테스트
